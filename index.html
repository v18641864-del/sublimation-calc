<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="manifest" href="manifest.json" />
<title>ZT.ART — Калькулятор сублимации (до 20 м)</title>
<style>
  body{font-family:Inter,Roboto,Arial; background:#0b0b0b;color:#fff;margin:0;padding:14px}
  .card{max-width:960px;margin:8px auto;padding:16px;border-radius:10px;background:linear-gradient(180deg,#0f0f10,#0b0b0b);box-shadow:0 6px 18px rgba(0,0,0,.6)}
  h1{color:#e6c976;margin:0 0 8px;font-size:20px}
  label{display:block;margin:10px 0 6px;color:#dcdcdc;font-size:13px}
  input,select{width:100%;padding:8px;border-radius:6px;border:1px solid #222;background:#0b0b0b;color:#fff;font-size:15px}
  .row{display:flex;gap:10px}
  .col{flex:1}
  button{margin-top:12px;padding:10px 14px;border-radius:8px;border:0;background:#b99b4a;color:#0b0b0b;font-weight:700}
  .out{margin-top:12px;padding:12px;border-radius:8px;background:#090909;border:1px solid #222}
  .muted{color:#bdbdbd;font-size:13px}
  footer{margin-top:14px;text-align:center;color:#bdbdbd;font-size:13px}
  small.note{display:block;margin-top:6px;color:#cfcfcf}
</style>
</head>
<body>
<div class="card">
  <h1>ZT.ART — Калькулятор цены (сублимация)</h1>
  <div class="muted">Введите размеры — система считает мгновенно (поддержка мм / см / м). Максимальный размер: 20 м.</div>

  <label>Ширина</label>
  <div class="row">
    <div class="col"><input id="w" type="number" step="0.1" min="0.1" value="300" /></div>
    <div style="width:120px">
      <select id="unitW">
        <option value="mm">мм</option>
        <option value="cm" selected>см</option>
        <option value="m">м</option>
      </select>
    </div>
  </div>

  <label>Высота</label>
  <div class="row">
    <div class="col"><input id="h" type="number" step="0.1" min="0.1" value="400" /></div>
    <div style="width:120px">
      <select id="unitH">
        <option value="mm">мм</option>
        <option value="cm" selected>см</option>
        <option value="m">м</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>Материал / покрытие</label>
      <select id="material">
        <option value="chrome">Хромолюкс (Gloss White, 0.45 мм)</option>
        <option value="aluminum">Алюминий (матовый)</option>
      </select>
    </div>
    <div class="col">
      <label>Количество панелей (модульность)</label>
      <input id="panels" type="number" min="1" step="1" value="1"/>
    </div>
  </div>

  <label>Тарифы (настройка)</label>
  <div class="row">
    <div class="col">
      <input id="ratePerM2" type="number" step="100" value="70000" />
      <small class="muted">тг / м² (используется для расчёта нестандартных размеров)</small>
    </div>
    <div class="col">
      <input id="minPrice" type="number" step="100" value="10000" />
      <small class="muted">минимальная цена (тг)</small>
    </div>
  </div>

  <label>Коэффициент за нестандарт/сложную обработку (%)</label>
  <input id="coef" type="number" min="0" step="1" value="20" />

  <div style="margin-top:12px">
    <button id="calc">Рассчитать</button>
  </div>

  <div class="out" id="resultBox">
    <div class="muted">Результат</div>
    <div id="price" style="font-size:22px;font-weight:700;margin-top:6px">—</div>
    <div id="note" class="muted" style="margin-top:6px">—</div>
  </div>

  <div class="out" id="consBox">
    <div class="muted">Расход материалов (приблизительно)</div>
    <div id="consumption" style="margin-top:6px">—</div>
  </div>

  <small class="note">Если размер точно совпадает со стандартным форматом (например A4, A3, 40×60 и т.д.), приложение выдаст стандартную цену из прайса.</small>

  <footer>Автор: Жулдыз Тююкпаев — ZT.ART</footer>
</div>

<script>
/*
  Объяснение алгоритма:
  - переводим вход (mm/cm/m) в метры
  - проверяем ограничения: ни больше 20 м
  - ищем совпадение в стандартных форматах (таблица ниже) — если совпадает, вернём стандартную цену
  - иначе считаем price = max(minPrice, round(area_m2 * ratePerM2)) + коэффициент
  - округление до 100 тг
*/

// Таблица стандартных цен (можете редактировать)
const STANDARD_PRICES = [
  // format: {w_cm, h_cm, price}
  {w:21, h:30, price:12000}, // A4
  {w:30, h:42, price:22000}, // A3
  {w:30, h:45, price:25000}, // A3+
  {w:40, h:50, price:33000},
  {w:40, h:60, price:40000},
  {w:20, h:20, price:10000},
  {w:25, h:25, price:14000},
  {w:30, h:30, price:18000},
  {w:35, h:35, price:22000},
  {w:40, h:40, price:28000},
  {w:50, h:50, price:38000},
  {w:20, h:30, price:11000},
  {w:25, h:35, price:15000},
  {w:30, h:40, price:20000},
  {w:30, h:60, price:35000},
  {w:50, h:60, price:45000}
];

// вспомогательные
function parseInputValue(id, unitId){
  const v = parseFloat(document.getElementById(id).value) || 0;
  const unit = document.getElementById(unitId).value;
  let meters = 0;
  if(unit === 'mm') meters = v/1000;
  else if(unit === 'cm') meters = v/100;
  else meters = v;
  return meters;
}

function findStandardPrice(w_cm, h_cm){
  // ищем точное совпадение (включая перестановку сторон)
  for(const s of STANDARD_PRICES){
    if( Math.abs(s.w - w_cm) < 0.01 && Math.abs(s.h - h_cm) < 0.01 ) return s.price;
    if( Math.abs(s.h - w_cm) < 0.01 && Math.abs(s.w - h_cm) < 0.01 ) return s.price;
  }
  return null;
}

function roundTo100(n){ return Math.round(n/100)*100; }

document.getElementById('calc').addEventListener('click', ()=>{
  // прочитать
  const w_m = parseInputValue('w','unitW');
  const h_m = parseInputValue('h','unitH');
  const panels = Math.max(1, parseInt(document.getElementById('panels').value)||1);
  const ratePerM2 = Math.max(0, parseFloat(document.getElementById('ratePerM2').value)||70000);
  const minPrice = Math.max(0, parseFloat(document.getElementById('minPrice').value)||10000);
  const coef = Math.max(0, parseFloat(document.getElementById('coef').value)||0);
  const material = document.getElementById('material').value;

  // ограничения
  if(w_m <= 0 || h_m <= 0){ alert('Введите корректные размеры'); return; }
  if(w_m > 20 || h_m > 20){ alert('Максимальный размер по одной стороне — 20 м'); return; }

  // площадь (м²)
  const area_m2 = w_m * h_m * panels;

  // поиск в стандартной таблице (в сантиметрах)
  const w_cm = w_m * 100;
  const h_cm = h_m * 100;
  const stdPrice = findStandardPrice(Number(w_cm.toFixed(2)), Number(h_cm.toFixed(2)));

  let basePrice;
  let usedAs = '';
  if(stdPrice !== null){
    basePrice = stdPrice * panels; // если панелей >1, умножаем
    usedAs = 'Стандартный формат (прайс-карта)';
  } else {
    // Выбор базового тарифа по материалу (можно расширить)
    let materialMultiplier = 1;
    if(material === 'chrome') materialMultiplier = 1.0;
    if(material === 'aluminum') materialMultiplier = 0.95;

    basePrice = area_m2 * ratePerM2 * materialMultiplier;
    if(basePrice < minPrice) basePrice = minPrice;
    usedAs = 'Расчёт по площади';
  }

  // применение коэффициента (н-р 20% за нестандарт)
  const extra = basePrice * (coef/100);
  let total = basePrice + extra;
  total = roundTo100(total);

  // Защита: если вдруг получилось меньше минималки, установим minPrice
  if(total < minPrice) total = roundTo100(minPrice);

  // Расход материалов (примерная модель)
  // краска: 10 мл / м², цена 200 тг / мл
  const ink_ml_per_m2 = 10;
  const ink_price_per_ml = 200;
  const ink_ml = ink_ml_per_m2 * area_m2;
  const ink_cost = ink_ml * ink_price_per_ml;

  // бумага/перевод: 5000 тг / м²
  const paper_cost_per_m2 = 5000;
  const paper_cost = paper_cost_per_m2 * area_m2;

  // металл: разные цены по материалу
  const metal_cost_per_m2 = (material === 'chrome') ? 25000 : 23000;
  const metal_cost = metal_cost_per_m2 * area_m2;

  const materials_total = Math.round(ink_cost + paper_cost + metal_cost);

  // Вывод
  document.getElementById('price').innerText = total.toLocaleString() + ' тг';
  document.getElementById('note').innerText = `${usedAs}; площадь: ${area_m2.toFixed(4)} м²; панели: ${panels}; тариф ${ratePerM2.toLocaleString()} тг/м²; коэффициент ${coef}%`;

  document.getElementById('consumption').innerText =
    `Краска: ${ink_ml.toFixed(1)} мл (~${Math.round(ink_cost).toLocaleString()} тг); ` +
    `Бумага/перевод: ~${Math.round(paper_cost).toLocaleString()} тг; ` +
    `Металл: ~${Math.round(metal_cost).toLocaleString()} тг; ` +
    `Итого расход: ~${materials_total.toLocaleString()} тг.`;

});
</script>
</body>
</html>
